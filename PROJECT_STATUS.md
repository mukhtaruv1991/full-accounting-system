# دستور وخطة عمل مشروع نظام المحاسبة المتكامل (الإصدار 5.0 - رؤية CRM)
*آخر تحديث: 23 سبتمبر 2025*

---
## 1. المبادئ الأساسية الحاكمة
- **العمل بدون اتصال (Offline-First):** التطبيق يعمل بكامل وظائفه المحاسبية الأساسية دون الحاجة للاتصال بالإنترنت.
- **تجربة مستخدم متجاوبة (Responsive UI):** الواجهات مصممة لتعمل بكفاءة وسلاسة على الهواتف والأجهزة المكتبية.
- **المزامنة السحابية الاختيارية (Optional Cloud Sync):** الاتصال بالإنترنت يضيف طبقة من الميزات المتقدمة.
- **الأمان والتدقيق:** كل عملية يتم تسجيلها وتخضع لنظام صلاحيات دقيق.
- **التكامل والتواصل الذكي:** التطبيق هو مركز للتواصل وإدارة علاقات العملاء والموردين.

---
## 2. تفصيل حالة المراحل وخطة العمل

### ✅ المرحلة 0, 1, 2, 3, 4: الأساس التقني والمحاسبي (100% مكتملة)
- **الحالة:** مكتملة ومستقرة.
- **الوصف:** تم بناء الأساس التقني، الواجهات، والوحدات المحاسبية الأساسية التي تعمل بدون إنترنت.

---
### 🟠 المرحلة 5: الأمان والمزامنة (قيد التنفيذ)
- **الحالة:** 50% مكتملة
- **المنجز:** بناء أساس الأمان والتدقيق بالكامل في الخادم، وحل جميع مشاكل البناء والنشر.
- **المتبقي (خطة العمل التفصيلية):**
  - **[ ] بناء واجهة إدارة الأدوار والصلاحيات:** تصميم وبناء صفحة في الإعدادات تسمح للأدمن بإنشاء أدوار وتعيين صلاحيات دقيقة لكل دور.
  - **[ ] تطبيق حارس الصلاحيات:** استخدام الديكور (`@Permissions`) لحماية المسارات الحساسة في الخادم.
  - **[ ] بناء خدمة المزامنة الذكية (`SyncService`):** كتابة الخدمة المسؤولة عن مزامنة البيانات بين الجهاز والسحابة.
  - **[ ] بناء نظام النسخ الاحتياطي والتصدير:** إضافة وظائف لتصدير البيانات محلياً (JSON) وسحابياً (Google Drive).

---
### ⬜ المرحلة 6: الميزات الاجتماعية والتفاعلية المتقدمة
- **الحالة:** 5% مكتملة
- **المتبقي (خطة العمل التفصيلية):**
  - **[ ] تفعيل المحادثات الفردية:** ربط الواجهة بـ `Socket.IO` لتصبح حية وتفاعلية بالكامل.
  - **[ ] بناء نظام المجموعات الديناميكي (القروبات):**
    - **الهدف:** إنشاء مجموعات محادثة بناءً على تصنيفات محددة.
    - **الخادم:** تعديل قاعدة البيانات للسماح بإنشاء مجموعات وربطها بمعايير (مثل: منطقة العميل، تصنيف المورد).
    - **الواجهة:** بناء واجهة للأدمن لإنشاء هذه المجموعات (e.g., "عملاء منطقة الرياض", "الموردون الرئيسيون").
  - **[ ] بناء نظام الإعلانات الموجهة:**
    - **الهدف:** إرسال إعلانات أو إشعارات لحسابات أو تصنيفات معينة.
    - **الواجهة:**
      1. بناء واجهة للأدمن لكتابة رسالة الإعلان وتحديد الجمهور المستهدف (e.g., كل العملاء، تصنيف "العملاء المميزون").
      2. بناء مكون (Banner) يظهر في أعلى أو أسفل التطبيق لعرض هذه الإعلانات للمستخدمين المستهدفين.
    - **الخادم:** بناء API لاستقبال هذه الإعلانات وإرسالها كإشعارات للمستخدمين المحددين.

---
### ⬜ المرحلة 7: التقارير والإعدادات المتقدمة
- **الحالة:** 0% مكتملة
- **المتبقي (خطة العمل التفصيلية):**
  - **[ ] استكمال التقارير المتقدمة:** بناء واجهات كشف الحساب، تقارير المخزون، والتقارير المالية.
  - **[ ] بناء سجل النشاطات (Audit Log):** بناء واجهة لعرض سجل بجميع العمليات التي تمت في النظام.

---
### ⬜ المرحلة 8: الذكاء الاصطناعي (مستقبلية)
- **الحالة:** 0% مكتملة
- **الوصف:** بناء واجهات المحادثة مع الذكاء الاصطناعي للاستعلام عن البيانات وتقديم رؤى تحليلية.

---
### ⬜ المرحلة 9 (جديدة): عمليات الأعمال المتقدمة والتكامل الخارجي (CRM)
- **الحالة:** 0% مكتملة
- **الهدف:** بناء أدوات لإدارة العمليات التجارية اليومية والتواصل الخارجي.
- **المتبقي (خطة العمل التفصيلية):**
  - **[ ] بناء نظام إدارة الطلبيات للموردين:**
    - **الواجهة:** بناء شاشة جديدة لإنشاء "طلبية شراء" للموردين، وتحديد الأصناف والكميات.
    - **نظام التذكير:** إضافة حقل "تاريخ التذكير" في الطلبية، ويقوم النظام بإرسال إشعار للأدمن في ذلك التاريخ.
  - **[ ] بناء نظام طلبات توريد الأصناف للعملاء:**
    - **الواجهة (للحسابات/العملاء):** بناء نموذج بسيط يسمح للعميل بطلب صنف معين مع رفع صورة وتحديد الكمية والموقع وتاريخ التسليم المطلوب.
    - **الواجهة (للأدمن):** بناء لوحة تحكم جديدة لعرض هذه الطلبات وإدارتها (قبول، رفض، تحديد السعر).
    - **الخادم:** بناء API وجداول قاعدة البيانات اللازمة لإدارة هذه الطلبات.
  - **[ ] بناء نظام الإشعارات متعدد القنوات:**
    - **الهدف:** تمكين الأدمن من إرسال الإشعارات عبر قنوات متعددة.
    - **الخادم:** التكامل مع خدمات خارجية مثل Twilio (للواتساب والـ SMS) و Telegram Bot API.
    - **الواجهة (إعدادات الحساب):** عند إضافة أو تعديل أي حساب (عميل، مورد)، إضافة قسم جديد لاختيار قناة الإشعار المفضلة له (تطبيق، واتساب، تلجرام، نصية).
    - **المنطق الذكي:** عند إرسال إشعار، يقوم النظام بالتحقق: إذا كان الحساب مستخدماً للتطبيق، يرسل الإشعار داخل التطبيق. إذا لم يكن، يرسله عبر القناة المفضلة التي تم ضبطها.
